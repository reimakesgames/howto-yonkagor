<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>HowTo</title>

		<link rel="stylesheet" href="css/style.css" />
		<link
			rel="stylesheet"
			href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
		/>

		<meta property="theme-color" content="#8fb663" />

		<!-- embed -->
		<meta property="og:title" content="HowTo Homepage" />
		<meta property="og:type" content="website" />
		<meta
			property="og:url"
			content="https://reimakesgames.github.io/howto-yonkagor/"
		/>
		<meta
			property="og:image"
			content="https://reimakesgames.github.io/howto-yonkagor/assets/tetra.gif"
		/>
		<meta
			property="og:description"
			content="HowTo is a website that helps you find the best way to do things."
		/>

		<!-- twitter -->
		<meta name="twitter:card" content="summary_large_image" />
		<meta name="twitter:site" content="@yonkagor" />
		<meta name="twitter:creator" content="@yonkagor" />
		<meta name="twitter:title" content="HowTo Homepage" />
		<meta
			name="twitter:description"
			content="HowTo is a website that helps you find the best way to do things."
		/>

		<!-- favicon -->
		<link
			rel="icon"
			type="image"
			href="https://reimakesgames.github.io/howto-yonkagor/assets/tetra.webp"
		/>
	</head>
	<body>
		<div class="top-nav">
			<div class="left-anchor">
				<!-- return to home -->
				<a class="logo" href="index.html">
					<span></span>
				</a>
				<div class="search">
					<input
						type="text"
						name="search"
						id="query"
						placeholder="earn enough money for rent..."
					/>
					<div class="search-button">
						<span
							class="material-symbols-outlined"
							style="font-size: 36px; color: #fff"
						>
							search
						</span>
					</div>
				</div>
			</div>
			<div></div>
		</div>
		<div class="responsive-container">
			<div class="content">
				<div class="left"></div>
				<div class="right"></div>
				<main>
					<div class="landing">
						<div class="landing-text">
							<div class="title">
								<span class="number">üêü</span>
								<h1 id="greeting">Welcome!</h1>
							</div>
							<p>
								This is the logged-in landing page! It's a work
								in progress.

								<br />
								<br />

								Your OAuth2 data has been disposed of, so you
								will need to log in again.

								<br />
								<br />

								Your profile will look something like this:
								<br />
								<img
									id="profile"
									src=""
									width="240px"
									height="240px"
									crossorigin="anonymous"
								/>
							</p>
						</div>
						<script>
							async function getUserData(access_token) {
								const response = await fetch(
									"https://discord.com/api/v10/users/@me",
									{
										headers: {
											authorization: `Bearer ${access_token}`,
										},
									}
								)

								return await response.json()
							}
							const urlParams = new URLSearchParams(
								window.location.search
							)
							const query = urlParams.get("access_token")

							if (query) {
								// get discord access token from url
								const token = atob(query)
								getUserData(token).then((data) => {
									document.getElementById(
										"greeting"
									).innerHTML = `Welcome, ${data.username}!`

									if (data.avatar !== null) {
										document.getElementById(
											"profile"
										).src = `https://cdn.discordapp.com/avatars/${data.id}/${data.avatar}.png?size=240`
									} else {
										let id = data.discriminator % 5
										document.getElementById(
											"profile"
										).src = `https://cdn.discordapp.com/embed/avatars/${id}.png?size=240`
									}
								})
							}
						</script>
						<div class="landing-image">
							<img
								src="assets/tetra.gif"
								alt="tetra"
								width="20%"
							/>
						</div>
					</div>
				</main>
			</div>
		</div>
	</body>
</html>
